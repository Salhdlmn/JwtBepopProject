@model BepopStreamProject.Models.ChartViewModel
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    var userLevel = User.GetUserLevel();
    var userId = User.GetUserId();
}

<div>
    <div class="page-content page-container" id="page-content">
        <div class="padding sr" id="list" data-plugin="list" data-page="50">
            <div class="page-hero">
                <div class="media bg-media">
                    <div class="media-content">
                    </div>
                </div>
                <div class="pos-rlt">
                    <h1 class="display-3 font-weight-bold text-white">Haftanın En Popüler Parçaları</h1>
                </div>
            </div>
            <div class="d-lg-flex pos-rlt">
                <div class="flex">
                    <div class="heading pt-5 pb-3 d-flex ">
                        <div>
                            <h5 class="text-highlight sr-item">Haftanın Popülerleri</h5>
                        </div>
                        <span class="flex"></span>
                    </div>
                    <div class="pos-rlt z-index-1">
                        <div class="d-flex py-2 sr-item">
                            <div class="dropdown my-2">
                                <button class="btn btn-outline-light sorting w-sm w-auto-xs text-align-auto" data-toggle="dropdown"><span>Yeni</span></button>
                                <div class="dropdown-menu">
                                    <a href="#" class="dropdown-item sort" data-sort="num" data-order="desc">Popüler</a>
                                    <a href="#" class="dropdown-item sort" data-sort="author" data-order="desc">Yeni</a>
                                </div>
                            </div>
                            <div class="flex"></div>
                            <div class="dropdown my-2 mx-2">
                                <button class="btn btn-outline-light sorting w-sm w-auto-xs text-align-auto"
                                        data-toggle="dropdown">
                                    <span>@ViewBag.SelectedCountry </span>
                                </button>
                                <div class="dropdown-menu" id="filter-tag">
                                    <a href="@Url.Action("Index", "Chart")" class="dropdown-item">Tüm ülkeler</a>
                                    @foreach (var country in Model.Countries)
                                    {
                                        <a href="@Url.Action("Index", "Chart", new { country = country })"
                                           class="dropdown-item">@country</a>
                                    }
                                </div>
                            </div>
                            <div class="dropdown my-2">
                                <button class="btn btn-outline-light sorting w-sm w-auto-xs text-align-auto"
                                        data-toggle="dropdown">
                                    <span>@ViewBag.SelectedGenre</span>
                                </button>

                                <div class="dropdown-menu dropdown-menu-right scrollable hover"
                                     id="filter-category" style="max-height: 310px; overflow-y: auto;">
                                    <!-- All genres seçeneği -->
                                    <a href="@Url.Action("Index", "Chart", new { genre = "All genres" })"
                                       class="dropdown-item">All genres</a>

                                    <!-- Genre listesi -->
                                    @foreach (var genre in Model.Genres)
                                    {
                                        <a href="@Url.Action("Index", "Chart", new { genre = genre })"
                                           class="dropdown-item">@genre</a>
                                    }
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="row list list-row list-index ">
                        @foreach (var item in Model.AllSongs)
                        {
                            <div class="col-12"
                                 data-id="@item.SongId"
                                 data-level="@item.Level"
                                 data-source="@item.FileUrl"
                                 data-category="@string.Join(", ", item.Genres)"
                                 data-tag="@item.ArtistName">

                                <div class="list-item r list-hover mb-3">
                                    <div class="media">
                                        <a href="#" class="ajax media-content" style="background-image:url(@item.ImageUrl)"></a>

                                        <div class="media-action media-action-overlay">
                                            <!-- Favori -->
                                            <button class="btn btn-icon no-bg no-shadow hide-row" data-toggle="class">
                                                <i data-feather="heart" class="active-fill"></i>
                                            </button>

                                            <!-- Kullanıcı seviyesi kontrolü -->
                                            @if (userLevel >= item.Level)
                                            {
                                                <button class="btn btn-raised btn-icon btn-rounded bg--white btn-play"
                                                        onclick="location.href='@Url.Action("Play", "Songs", new { songId = item.SongId })'">
                                                    <i data-feather="play"></i>
                                                </button>
                                            }
                                            else
                                            {
                                                <button class="btn btn-icon btn-rounded bg--gray" disabled title="Seviyen yetersiz">
                                                    <i data-feather="lock"></i>
                                                </button>
                                            }

                                            <!-- Menü -->
                                            <button class="btn btn-icon no-bg no-shadow hide-row btn-more" data-toggle="dropdown">
                                                <i data-feather="more-horizontal"></i>
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-right">
                                                <a class="dropdown-item" href="#">Add to Playlist</a>
                                                <a class="dropdown-item" href="#">Share</a>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Şarkı Bilgileri -->
                                    <div class="list-content text-center">
                                        <div class="list-body">
                                            <a href="#" class="list-title title ajax h-1x">@item.Title</a>
                                            <a href="#" class="list-subtitle d-block text-muted h-1x subtitle ajax">@item.ArtistName</a>

                                            @if (item.Genres != null && item.Genres.Any())
                                            {
                                                <small class="text-muted">@string.Join(", ", item.Genres)</small>
                                            }
                                        </div>
                                    </div>

                                    <!-- Alt satır -->
                                    <div class="list-action show-row">
                                        <div class="d-flex align-items-center">
                                            <!-- Beğeni -->
                                            <button class="btn btn-icon no-bg no-shadow" data-toggle="class">
                                                <i data-feather="heart" class="active-primary"></i>
                                            </button>
                                            <!-- Daha fazla menü -->
                                            <button class="btn btn-icon no-bg no-shadow btn-more" data-toggle="dropdown">
                                                <i data-feather="more-horizontal"></i>
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-right">
                                                <a class="dropdown-item" href="#">Report</a>
                                                <a class="dropdown-item" href="#">Details</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }

                     
                      
                    </div>
                    <div class="no-result hide">
                        <div class="p-5 text-center">
                            <h5>Hiçbir şey bulunamadı</h5>
                            <small>Aradığınızı bulamıyoruz.</small>
                        </div>
                    </div>
                    <div class="d-flex py-3 justify-content-center hide">
                        <ul class="pagination pagination-sm"></ul>
                    </div>
                </div>
                <div style="min-width: 4rem"></div>
                <div class="w-xl w-auto-sm no-shrink">
                    <div class="sticky">
                        <div class="list mb-5">
                            <div class="list-item list-overlay r">
                                <div class="media ">
                                    <a href="item.detail.html#" class="ajax media-content " style="background-image:url(/Bepop/assets/img/b16.jpg)">
                                    </a>
                                    <div class="media-action ">
                                    </div>
                                </div>
                                <div class="list-content p-5 text-center">
                                    <div class="list-body ">
                                        <a href="item.detail.html#" class="list-title title ajax h3 font-weight-bold">
                                            Hip-Hop 100 Listesi
                                        </a>
                                        <a href="artist.detail.html#" class="list-subtitle d-block text-muted h-1x subtitle ajax ">
                                            Şu anki en çılgın rap
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h6 class="text text-muted sr-item">En Çok Dinlenenler</h6>
                        <div class="row list-row">

                            @foreach (var item in Model.TopTracks)
                            {
                                <div class="col-12" data-id="@item.SongId" data-category="@string.Join(", ", item.Genres)" data-tag="@item.ArtistName" data-source="@item.FileUrl">
                                    <div class="list-item r">
                                        <div class="media">
                                            <a href="#" class="ajax media-content" style="background-image:url(@item.ImageUrl)">
                                            </a>
                                            <div class="media-action">
                                                <button class="btn btn-icon no-bg no-shadow hide-row" data-toggle="class">
                                                    <i data-feather="heart" class="active-fill"></i>
                                                </button>

                                                @if (userLevel >= item.Level)
                                                {
                                                    <!-- Oynatma SongsController.Play üzerinden -->
                                                    <a class="btn btn-raised btn-icon btn-rounded bg--white btn-play"
                                                       href="@Url.Action("Play", "Songs", new { songId = item.SongId })">
                                                        <i data-feather="play"></i>
                                                    </a>
                                                }
                                                else
                                                {
                                                    <!-- Paket yetersiz ise -->
                                                    <button class="btn btn-icon btn-rounded bg--gray" disabled title="Seviyen yetersiz">
                                                        <i data-feather="lock"></i>
                                                    </button>
                                                }

                                                <button class="btn btn-icon no-bg no-shadow hide-row btn-more" data-toggle="dropdown">
                                                    <i data-feather="more-horizontal"></i>
                                                </button>
                                                <div class="dropdown-menu dropdown-menu-right"></div>
                                            </div>
                                        </div>

                                        <div class="list-content text-center">
                                            <div class="list-body">
                                                <a href="#" class="list-title title ajax h-1x">@item.Title</a>
                                                <a href="#" class="list-subtitle d-block text-muted h-1x subtitle ajax">
                                                    @item.ArtistName
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

